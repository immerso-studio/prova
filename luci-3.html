<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuratore Illuminazione Esterni</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
            background: #1a1a1a;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* Frosted glass style */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Control Panel */
        #control-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            z-index: 10;
            min-width: 320px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 18px;
            font-weight: 300;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn svg {
            width: 20px;
            height: 20px;
        }

        #light-toggle {
            background: rgba(255, 200, 0, 0.2);
            border: 1px solid rgba(255, 200, 0, 0.4);
            width: 56px;
            height: 56px;
        }

        #light-toggle.active {
            background: rgba(255, 200, 0, 0.4);
            box-shadow: 0 0 20px rgba(255, 200, 0, 0.5);
        }

        .product-name {
            color: white;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            min-width: 150px;
        }

        /* Light Controls */
        #light-controls {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px;
            z-index: 10;
            min-width: 280px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #light-controls.visible {
            opacity: 1;
            pointer-events: all;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-group:last-child {
            margin-bottom: 0;
        }

        .slider-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slider-value {
            color: rgba(255, 200, 0, 0.9);
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 200, 0, 0.9);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 200, 0, 0.9);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* Info Panel */
        #info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 25px;
            max-width: 320px;
            z-index: 10;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #info-panel.visible {
            transform: translateX(0);
        }

        #info-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 11;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-section p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.6;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spec-item:last-child {
            border-bottom: none;
        }

        .spec-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
        }

        .spec-value {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #control-panel {
                bottom: 10px;
                padding: 15px 20px;
                gap: 20px;
                min-width: auto;
            }

            .control-btn {
                width: 42px;
                height: 42px;
            }

            #light-toggle {
                width: 50px;
                height: 50px;
            }

            .product-name {
                font-size: 14px;
                min-width: 120px;
            }

            #light-controls {
                bottom: 80px;
                min-width: 260px;
            }

            #info-panel {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-400px);
            }

            #info-panel.visible {
                transform: translateY(0);
            }

            #info-toggle {
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <!-- Info Toggle Button -->
    <button id="info-toggle" class="control-btn glass-panel">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke-width="2"/>
            <path d="M12 16v-4M12 8h.01" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>

    <!-- Info Panel -->
    <div id="info-panel" class="glass-panel">
        <div class="info-section">
            <h3 id="info-title">Lampada A</h3>
            <p id="info-description">Lampada da parete per esterni con design moderno e illuminazione LED ad alta efficienza.</p>
        </div>
        <div class="info-section">
            <h3>Specifiche Tecniche</h3>
            <div class="spec-item">
                <span class="spec-label">Potenza</span>
                <span class="spec-value" id="spec-power">15W</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Lumen</span>
                <span class="spec-value" id="spec-lumen">1200 lm</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Temperatura</span>
                <span class="spec-value" id="spec-temp">3000K</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">IP Rating</span>
                <span class="spec-value" id="spec-ip">IP65</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Materiale</span>
                <span class="spec-value" id="spec-material">Alluminio</span>
            </div>
        </div>
    </div>

    <!-- Light Controls -->
    <div id="light-controls" class="glass-panel">
        <div class="slider-group">
            <div class="slider-label">
                <span>Intensità</span>
                <span class="slider-value" id="intensity-value">3.0</span>
            </div>
            <input type="range" id="intensity-slider" min="0" max="5" step="0.1" value="3">
        </div>
        <div class="slider-group">
            <div class="slider-label">
                <span>Angolo</span>
                <span class="slider-value" id="angle-value">30°</span>
            </div>
            <input type="range" id="angle-slider" min="10" max="90" step="5" value="30">
        </div>
        <div class="slider-group">
            <div class="slider-label">
                <span>Distanza</span>
                <span class="slider-value" id="distance-value">15</span>
            </div>
            <input type="range" id="distance-slider" min="5" max="25" step="1" value="15">
        </div>
    </div>

    <!-- Control Panel -->
    <div id="control-panel" class="glass-panel">
        <button id="prev-btn" class="control-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <div class="product-name" id="product-name">Lampada A</div>
        <button id="light-toggle" class="control-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button id="next-btn" class="control-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Texture URLs - easily modifiable
        const TEXTURES = {
            wall: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iYnJpY2siIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHdpZHRoPSIxMDAiIGhlaWdodD0iNTAiPjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iNTAiIGZpbGw9IiMzYTNhM2EiLz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iOTgiIGhlaWdodD0iMjMiIGZpbGw9IiM0YTRhNGEiLz48cmVjdCB4PSIwIiB5PSIyNyIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjIzIiBmaWxsPSIjNGE0YTRhIi8+PHJlY3QgeD0iNTIiIHk9IjI3IiB3aWR0aD0iNDgiIGhlaWdodD0iMjMiIGZpbGw9IiM0YTRhNGEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIiBmaWxsPSJ1cmwoI2JyaWNrKSIvPjwvc3ZnPg==',
            floor: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iY29uY3JldGUiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzJhMmEyYSIvPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSI5OCIgaGVpZ2h0PSI5OCIgZmlsbD0iIzJjMmMyYyIgc3Ryb2tlPSIjMWExYTFhIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIiBmaWxsPSJ1cmwoI2NvbmNyZXRlKSIvPjwvc3ZnPg=='
        };

        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);
        scene.fog = new THREE.Fog(0x1a1a1a, 15, 40);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // Isometric view
        camera.position.set(8, 6, 8);
        camera.lookAt(0, 2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Texture Loader
        const textureLoader = new THREE.TextureLoader();

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        const mainLight = new THREE.DirectionalLight(0xffffff, 0.5);
        mainLight.position.set(5, 10, 5);
        mainLight.castShadow = true;
        mainLight.shadow.mapSize.width = 2048;
        mainLight.shadow.mapSize.height = 2048;
        mainLight.shadow.camera.left = -15;
        mainLight.shadow.camera.right = 15;
        mainLight.shadow.camera.top = 15;
        mainLight.shadow.camera.bottom = -15;
        scene.add(mainLight);

        // Floor with texture
        const floorTexture = textureLoader.load(TEXTURES.floor);
        floorTexture.wrapS = THREE.RepeatWrapping;
        floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set(8, 8);

        const floorGeometry = new THREE.PlaneGeometry(30, 30);
        const floorMaterial = new THREE.MeshStandardMaterial({ 
            map: floorTexture,
            roughness: 0.8,
            metalness: 0.2
        });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Wall with texture
        const wallTexture = textureLoader.load(TEXTURES.wall);
        wallTexture.wrapS = THREE.RepeatWrapping;
        wallTexture.wrapT = THREE.RepeatWrapping;
        wallTexture.repeat.set(6, 3);

        const wallGeometry = new THREE.PlaneGeometry(30, 15);
        const wallMaterial = new THREE.MeshStandardMaterial({ 
            map: wallTexture,
            roughness: 0.9,
            metalness: 0.1
        });
        const wall = new THREE.Mesh(wallGeometry, wallMaterial);
        wall.position.set(0, 7.5, -5);
        wall.receiveShadow = true;
        scene.add(wall);

        // Products data
        const products = [
            {
                name: 'Lampada A',
                description: 'Lampada da parete per esterni con design moderno e illuminazione LED ad alta efficienza.',
                specs: {
                    power: '15W',
                    lumen: '1200 lm',
                    temp: '3000K',
                    ip: 'IP65',
                    material: 'Alluminio'
                },
                geometry: new THREE.CylinderGeometry(0.3, 0.3, 1.5, 32),
                color: 0x808080,
                position: { x: 0, y: 3, z: -4.5 },
                rotation: { x: Math.PI / 2, y: 0, z: 0 },
                lightType: 'spot' // circular
            },
            {
                name: 'Lampada B',
                description: 'Lampione da parete elegante con tecnologia LED avanzata e resistenza agli agenti atmosferici.',
                specs: {
                    power: '25W',
                    lumen: '2000 lm',
                    temp: '4000K',
                    ip: 'IP67',
                    material: 'Acciaio Inox'
                },
                geometry: new THREE.BoxGeometry(0.8, 0.8, 1.2),
                color: 0x606060,
                position: { x: 0, y: 2.5, z: -4.4 },
                rotation: { x: 0, y: 0, z: 0 },
                lightType: 'square' // square projection
            },
            {
                name: 'Lampada C',
                description: 'Faretto orientabile per illuminazione architettonica con fascio luminoso regolabile.',
                specs: {
                    power: '20W',
                    lumen: '1600 lm',
                    temp: '3500K',
                    ip: 'IP66',
                    material: 'Alluminio Pressofuso'
                },
                geometry: new THREE.ConeGeometry(0.4, 1, 32),
                color: 0x707070,
                position: { x: 0, y: 2.8, z: -4.5 },
                rotation: { x: Math.PI / 4, y: 0, z: 0 },
                lightType: 'rect' // rectangular projection
            }
        ];

        let currentIndex = 0;
        let currentMesh = null;
        let spotLight = null;
        let rectLight = null;
        let isLightOn = false;

        // Light parameters
        let lightIntensity = 3;
        let lightAngle = 30;
        let lightDistance = 15;

        // Create product mesh
        function createProduct(index) {
            if (currentMesh) {
                scene.remove(currentMesh);
            }
            if (spotLight) {
                scene.remove(spotLight);
                scene.remove(spotLight.target);
            }
            if (rectLight) {
                scene.remove(rectLight);
            }

            const product = products[index];
            const material = new THREE.MeshStandardMaterial({ 
                color: product.color,
                roughness: 0.4,
                metalness: 0.7
            });
            
            currentMesh = new THREE.Mesh(product.geometry, material);
            currentMesh.position.set(product.position.x, product.position.y, product.position.z);
            currentMesh.rotation.set(product.rotation.x, product.rotation.y, product.rotation.z);
            currentMesh.castShadow = true;
            currentMesh.receiveShadow = true;
            scene.add(currentMesh);

            // Create light based on type
            if (product.lightType === 'spot') {
                // Circular spotlight
                spotLight = new THREE.SpotLight(0xffcc66, 0, lightDistance, (lightAngle * Math.PI) / 180, 0.3, 1.5);
                spotLight.position.copy(currentMesh.position);
                spotLight.position.z += 0.3;
                spotLight.target.position.set(product.position.x, 0, product.position.z + 3);
                spotLight.castShadow = true;
                spotLight.shadow.mapSize.width = 1024;
                spotLight.shadow.mapSize.height = 1024;
                scene.add(spotLight);
                scene.add(spotLight.target);
            } else if (product.lightType === 'square') {
                // Square projection using RectAreaLight
                rectLight = new THREE.RectAreaLight(0xffcc66, 0, 3, 3);
                rectLight.position.set(product.position.x, 0.1, product.position.z + 2);
                rectLight.lookAt(product.position.x, 0, product.position.z + 3);
                scene.add(rectLight);
                
                // Add spotlight for shadows
                spotLight = new THREE.SpotLight(0xffcc66, 0, lightDistance, (lightAngle * Math.PI) / 180, 0.3, 1.5);
                spotLight.position.copy(currentMesh.position);
                spotLight.position.z += 0.3;
                spotLight.target.position.set(product.position.x, 0, product.position.z + 3);
                spotLight.castShadow = true;
                spotLight.shadow.mapSize.width = 1024;
                spotLight.shadow.mapSize.height = 1024;
                scene.add(spotLight);
                scene.add(spotLight.target);
            } else if (product.lightType === 'rect') {
                // Rectangular projection
                rectLight = new THREE.RectAreaLight(0xffcc66, 0, 4, 2);
                rectLight.position.set(product.position.x, 0.1, product.position.z + 2);
                rectLight.lookAt(product.position.x, 0, product.position.z + 3);
                scene.add(rectLight);
                
                // Add spotlight for shadows
                spotLight = new THREE.SpotLight(0xffcc66, 0, lightDistance, (lightAngle * Math.PI) / 180, 0.3, 1.5);
                spotLight.position.copy(currentMesh.position);
                spotLight.position.z += 0.3;
                spotLight.target.position.set(product.position.x, 0, product.position.z + 3);
                spotLight.castShadow = true;
                spotLight.shadow.mapSize.width = 1024;
                spotLight.shadow.mapSize.height = 1024;
                scene.add(spotLight);
                scene.add(spotLight.target);
            }

            if (isLightOn) {
                updateLightState(true);
            }

            updateUI(index);
        }

        // Update UI
        function updateUI(index) {
            const product = products[index];
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('info-title').textContent = product.name;
            document.getElementById('info-description').textContent = product.description;
            document.getElementById('spec-power').textContent = product.specs.power;
            document.getElementById('spec-lumen').textContent = product.specs.lumen;
            document.getElementById('spec-temp').textContent = product.specs.temp;
            document.getElementById('spec-ip').textContent = product.specs.ip;
            document.getElementById('spec-material').textContent = product.specs.material;
        }

        // Update light state
        function updateLightState(on) {
            if (spotLight) {
                spotLight.intensity = on ? lightIntensity : 0;
            }
            if (rectLight) {
                rectLight.intensity = on ? lightIntensity * 2 : 0;
            }
        }

        // Toggle light
        function toggleLight() {
            isLightOn = !isLightOn;
            const toggle = document.getElementById('light-toggle');
            const controls = document.getElementById('light-controls');
            
            if (isLightOn) {
                updateLightState(true);
                toggle.classList.add('active');
                controls.classList.add('visible');
            } else {
                updateLightState(false);
                toggle.classList.remove('active');
                controls.classList.remove('visible');
            }
        }

        // Update light parameters
        function updateLightIntensity(value) {
            lightIntensity = parseFloat(value);
            document.getElementById('intensity-value').textContent = lightIntensity.toFixed(1);
            if (isLightOn) {
                updateLightState(true);
            }
        }

        function updateLightAngle(value) {
            lightAngle = parseInt(value);
            document.getElementById('angle-value').textContent = lightAngle + '°';
            if (spotLight) {
                spotLight.angle = (lightAngle * Math.PI) / 180;
            }
        }

        function updateLightDistance(value) {
            lightDistance = parseInt(value);
            document.getElementById('distance-value').textContent = lightDistance;
            if (spotLight) {
                spotLight.distance = lightDistance;
            }
        }

        // Navigation
        function nextProduct() {
            currentIndex = (currentIndex + 1) % products.length;
            createProduct(currentIndex);
        }

        function prevProduct() {
            currentIndex = (currentIndex - 1 + products.length) % products.length;
            createProduct(currentIndex);
        }

        // Event listeners
        document.getElementById('light-toggle').addEventListener('click', toggleLight);
        document.getElementById('next-btn').addEventListener('click', nextProduct);
        document.getElementById('prev-btn').addEventListener('click', prevProduct);

        document.getElementById('info-toggle').addEventListener('click', () => {
            const panel = document.getElementById('info-panel');
            panel.classList.toggle('visible');
        });

        // Light control sliders
        document.getElementById('intensity-slider').addEventListener('input', (e) => {
            updateLightIntensity(e.target.value);
        });

        document.getElementById('angle-slider').addEventListener('input', (e) => {
            updateLightAngle(e.target.value);
        });

        document.getElementById('distance-slider').addEventListener('input', (e) => {
            updateLightDistance(e.target.value);
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initialize
        createProduct(0);
        animate();
    </script>
</body>
</html>